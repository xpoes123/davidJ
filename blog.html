<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Blog</title>

  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      background: #0e0d0b;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: system-ui, Calibri, "Segoe UI", Roboto, Helvetica, Arial, sans-serif,
                   "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
    }

    .container {
      position: relative;
      width: 100vw;
      height: 100vh;
      background: #1c1b17;
      transition: all 0.8s ease;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    #homepage {
      width: 100%;
      height: 100%;
      box-sizing: border-box;
      padding: 20px;
      border-radius: 10px;
      overflow-y: auto;
      position: relative;
    }

    .homepage-left {
      width: 100%;
    }

    .cards-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-top: 50px;
      padding: 0;
    }

    .card {
      background: #2a2923;
      border: 1px solid #3d3b33;
      border-radius: 8px;
      padding: 16px;
      box-sizing: border-box;
      color: #fafafa;
      display: flex;
      flex-direction: column;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }

    .card h2 {
      margin: 0 0 8px;
      font-size: 1.1rem;
      color: #e4f221;
    }

    .card .date {
      margin: 0 0 8px;
      font-size: 0.85rem;
      color: #a8a79e;
      font-style: italic;
    }

    .card .preview {
      flex: 1;
      font-size: 0.9rem;
      color: #d4d3c8;
      margin-bottom: 12px;
      overflow: hidden;
      text-align: left;
      line-height: 1.4;
    }

    #homepage h1 {
      display: none;
    }

    #homepage p {
      color: #c8d51d;
    }

    #postContent img {
      max-width: 50%;
    }

    #postContent a {
      color: #cfd6ff;              /* no bright blue */
      text-decoration: none;
      border-bottom: 1px solid rgba(207, 214, 255, 0.35);
      transition: border-color 0.2s, color 0.2s, background 0.2s;
      padding: 0 2px;
      border-radius: 4px;
    }

    #readingProgress {
      position: absolute;
      top: 0;
      left: 0;
      height: 3px;
      width: 0%;
      background: #e4f221;
      transition: width 0.1s linear;
      z-index: 10;
    }

    /* Full post view */
    #postView {
      display: none;
      flex: 1;
      flex-direction: column;
      overflow: hidden;
    }

    #postContent {
      flex: 1;
      overflow-y: auto;
      padding: 20px;
      padding-top: 50px;
      color: #d4d3c8;
      position: relative;
    }

    #backBtn {
      position: absolute;
      top: 20px;
      left: 20px;
      color: #a8a79e;
      text-decoration: none;
      padding: 4px 2px;
      background: none;
      border: none;
      border-bottom: 1.5px solid transparent;
      font-family: inherit;
      font-size: 1rem;
      cursor: pointer;
      transition: color 0.2s, border-color 0.2s;
      z-index: 5;
    }

    #backBtn:hover {
      color: #e4f221;
      border-bottom-color: #e4f221;
    }

    .home-link {
      position: absolute;
      top: 20px;
      left: 20px;
      color: #a8a79e;
      text-decoration: none;
      padding: 4px 2px;
      background: none;
      border-bottom: 1.5px solid transparent;
      font-family: inherit;
      transition: color 0.2s, border-color 0.2s;
    }

    .home-link:hover {
      color: #e4f221;
      border-bottom-color: #e4f221;
    }

    /* Mobile Styles */
    @media (max-width: 768px) {
      .container {
        width: 100vw;
        height: 100vh;
      }

      #homepage {
        padding: 15px;
      }

      .home-link {
        top: 15px;
        left: 15px;
        padding: 6px 12px;
        font-size: 0.9rem;
      }

      .cards-container {
        grid-template-columns: 1fr;
        gap: 15px;
        margin-top: 15px;
      }

      .card {
        padding: 20px;
        border-radius: 12px;
      }

      .card h2 {
        font-size: 1.2rem;
        margin-bottom: 10px;
      }

      .card .date {
        font-size: 0.9rem;
        margin-bottom: 12px;
      }

      .card .preview {
        font-size: 1rem;
        line-height: 1.5;
        margin-bottom: 15px;
      }

      #postContent {
        padding: 15px;
        font-size: 1rem;
        line-height: 1.6;
      }

      #backBtn {
        font-size: 0.9rem;
      }
    }

    /* Extra small mobile devices */
    @media (max-width: 480px) {
      .container {
        width: 100vw;
        height: 100vh;
      }

      #homepage {
        padding: 10px;
      }

      .home-link {
        top: 10px;
        left: 10px;
        padding: 5px 10px;
        font-size: 0.8rem;
      }

      .cards-container {
        gap: 12px;
        margin-top: 10px;
      }

      .card {
        padding: 16px;
      }

      #postContent {
        padding: 12px;
      }
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>

<body>
  <div class="container">
    <!-- 1) Preview grid -->
    <div id="homepage">
      <h1>My Blog</h1>
      <a href="index.html?skip" class="home-link">Home</a>
      <div class="cards-container"></div>
    </div>

    <!-- 2) Full post view -->
    <div id="postView">
      <div id="readingProgress"></div>
      <button id="backBtn">&#8592; Back</button>
      <div id="postContent"></div>
    </div>
  </div>

  <script>
    const POSTS = [
      {
        title: "My Life Through Albums",
        slug: "albums",
        date: "Dec 12, 2025"
      },
      {
        title: "Reflecting Back on College",
        slug: "graduating",
        date:  "May 26, 2025"
      },
    ];

    const cardsContainer = document.querySelector(".cards-container");
    const homepage       = document.getElementById("homepage");
    const postView       = document.getElementById("postView");
    const postContent    = document.getElementById("postContent");
    const backBtn        = document.getElementById("backBtn");

    async function buildPreviews() {
      for (let post of POSTS) {
        const card = document.createElement("div");
        card.className = "card";

        card.innerHTML = `
          <h2>${post.title}</h2>
          <p class="date">${post.date || ''}</p>
          <div class="preview">Loading preview…</div>
        `;

        fetch(`posts/${post.slug}.md`)
          .then(r => r.text())
          .then(md => {
            const noHeaders = md
              .replace(/^(?:#{1,6}\s.*|\*\*Date:\*\*.*)$/gm, '')
              .trim();

            const words        = noHeaders.split(/\s+/);
            const snippetWords = words.slice(0, 20);
            const snippetMd    = snippetWords.join(' ') + (words.length > 20 ? '…' : '');

            card.querySelector('.preview').innerHTML = marked.parse(snippetMd);
          })
          .catch(_ => {
            card.querySelector(".preview").textContent = "Preview failed";
          });

        card.onclick = () => {
          history.pushState(null, '', `blog.html#${post.slug}`);
          showPost(post);
        };
        cardsContainer.append(card);
      }
    }

    async function showPost(post) {
      homepage.style.display  = "none";
      postView.style.display  = "flex";
      postContent.textContent = "Loading…";

      try {
        const md = await (await fetch(`posts/${post.slug}.md`)).text();
        postContent.innerHTML = marked.parse(md);
      } catch (e) {
        postContent.textContent = "Failed to load post.";
      }
    }

    backBtn.onclick = () => {
      history.pushState(null, '', 'blog.html');
      postView.style.display  = "none";
      homepage.style.display  = "block";
    };

    function routeFromHash() {
      const hash = window.location.hash.slice(1);
      if (hash) {
        const post = POSTS.find(p => p.slug === hash);
        if (post) {
          showPost(post);
          return;
        }
      }
      postView.style.display = "none";
      homepage.style.display = "block";
    }

    const readingProgress = document.getElementById("readingProgress");
    postContent.addEventListener("scroll", () => {
      const scrollable = postContent.scrollHeight - postContent.clientHeight;
      readingProgress.style.width = scrollable > 0
        ? (postContent.scrollTop / scrollable * 100) + "%"
        : "0%";
    });

    window.addEventListener('popstate', routeFromHash);

    buildPreviews();
    routeFromHash();
  </script>

</body>
</html>
